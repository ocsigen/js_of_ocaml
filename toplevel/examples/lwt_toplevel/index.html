<!DOCTYPE html>
<html lang="en">
  <head>
    <title>OCaml toplevel</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
      * { box-sizing: border-box; }

      body, html {
        height: 100%;
        margin: 0;
        background-color: #1e1e1e;
        color: #ddd;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        font-size: 14px;
        overflow: hidden;
      }

      code, kbd, pre, samp {
        font-family: "SF Mono", "Fira Code", Consolas, monospace;
      }

      /* Two-pane layout */
      #toplevel-wrapper {
        display: flex;
        height: 100%;
      }

      #toplevel-container {
        flex: 1 1 70%;
        min-width: 0;
        background-color: #161618;
        color: #ccc;
        overflow: auto;
        overflow-x: hidden;
        padding: 20px;
      }

      #toplevel-container {
        position: relative;
      }

      #repl-watermark {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 4em;
        font-weight: 700;
        letter-spacing: 0.05em;
        color: rgba(255, 255, 255, 0.04);
        pointer-events: none;
        user-select: none;
      }

      #toplevel-container pre#output {
        padding: 0;
        position: relative;
      }

      #toplevel-container #output {
        background-color: transparent;
        color: #ccc;
        border: none;
        line-height: 1.1;
        font-size: 13px;
        margin-bottom: 0;
        font-family: "SF Mono", "Fira Code", Consolas, monospace;
      }

      #toplevel-container #output div {
        margin: 0;
        padding: 0;
        line-height: 1.1;
        font-size: 13px;
      }

      #toplevel-container > div:last-of-type {
        display: flex;
        align-items: flex-start;
      }

      #toplevel-container textarea {
        flex: 1;
        min-width: 0;
        line-height: 20px;
        font-size: 13px;
        background-color: transparent;
        color: #fff;
        border: 0;
        resize: none;
        outline: none;
        font-family: "SF Mono", "Fira Code", Consolas, monospace;
        font-weight: bold;
        margin: 0;
        padding: 0;
      }

      #toplevel-container #sharp {
        line-height: 20px;
        font-size: 13px;
        font-family: "SF Mono", "Fira Code", Consolas, monospace;
        white-space: pre;
        flex-shrink: 0;
      }

      .sharp:before {
        content: "# ";
        line-height: 20px;
        font-size: 13px;
        font-family: "SF Mono", "Fira Code", Consolas, monospace;
      }

      .caml {
        color: rgb(110, 130, 220);
      }

      /* Resize handle */
      #resize-handle {
        width: 5px;
        cursor: col-resize;
        background: transparent;
        flex: 0 0 5px;
        transition: background 0.15s;
      }

      #resize-handle:hover,
      #resize-handle.dragging {
        background: rgba(255, 255, 255, 0.12);
      }

      #toplevel-side {
        flex: 1 1 30%;
        min-width: 0;
        overflow: auto;
        padding: 24px 30px;
        background-color: #1e1e1e;
        color: #ccc;
      }

      .sidebar-header {
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding-bottom: 16px;
        margin-bottom: 16px;
      }

      .sidebar-header h3 {
        margin: 0 0 4px;
        font-weight: 600;
        color: #eee;
        font-size: 1.4em;
      }

      .sidebar-header p.subtitle {
        margin: 0;
        color: #888;
        font-size: 0.95em;
      }

      #toplevel-side h4 {
        color: #aaa;
        font-weight: 500;
        font-size: 1em;
        margin: 1.2em 0 0.4em;
      }

      #toplevel-side p {
        color: #999;
        line-height: 1.6;
        margin: 0.5em 0;
      }

      #toplevel-side ul {
        padding: 0;
        list-style-type: none;
      }

      .stderr {
        color: #e06060;
      }

      .stdout {
        line-height: 1.3;
      }

      .errorloc {
        border-bottom: 3px solid #e06060;
      }

      canvas {
        background-color: #888;
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 4px;
      }

      #output canvas {
        background-color: #888;
        display: block;
        border: 1px solid rgba(255, 255, 255, 0.12);
        margin: 7px;
        border-radius: 4px;
      }

      #output img {
        display: block;
      }

      #examples-row {
        display: flex;
        align-items: flex-start;
        gap: 16px;
      }

      #toplevel-examples {
        flex: 1;
        min-width: 0;
        list-style: none;
        padding: 0;
        margin: 0;
      }

      #toplevel-examples .list-group-item {
        padding: 6px 10px;
        color: #aab;
        cursor: pointer;
        transition: background 0.15s, color 0.15s;
        display: block;
        text-decoration: none;
        font-size: 13px;
        border-radius: 4px;
        border-left: 2px solid transparent;
      }

      #toplevel-examples .list-group-item:hover {
        background: rgba(255, 255, 255, 0.07);
        color: #eee;
        border-left-color: rgba(255, 255, 255, 0.3);
      }

      #btn-share {
        background-color: #2a2a3a;
        color: #ccc;
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 6px;
        padding: 4px 12px;
        font-family: inherit;
        font-size: 13px;
        cursor: pointer;
        display: none;
        transition: background 0.15s;
        margin-left: auto;
        align-self: flex-start;
        flex-shrink: 0;
      }

      #btn-share:hover {
        background-color: #3a3a4a;
        color: #eee;
      }

      .clear { clear: both; }

      #output .share-url {
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 6px;
        padding: 8px 12px;
        margin: 6px 0;
        font-size: 12px;
        line-height: 1.5;
        word-break: break-all;
      }

      #output .share-url a {
        color: rgb(110, 160, 255);
        text-decoration: none;
      }

      #output .share-url a:hover {
        text-decoration: underline;
      }

      /* Keyboard shortcuts table */
      table {
        width: 100%;
        border-collapse: collapse;
        margin: 0 0 1em;
      }

      table td {
        padding: 6px 10px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        color: #bbb;
        font-size: 13px;
      }

      table td:first-child {
        color: #ddd;
        font-family: "SF Mono", "Fira Code", Consolas, monospace;
        font-size: 12px;
        white-space: nowrap;
      }

      /* JS preview */
      #js-details {
        margin-top: 1.2em;
      }

      #js-details summary {
        color: #aaa;
        font-weight: 500;
        font-size: 1em;
        cursor: pointer;
        padding: 6px 0;
        list-style: disclosure-closed;
      }

      #js-details[open] summary {
        list-style: disclosure-open;
        margin-bottom: 8px;
      }

      #js-details summary:hover {
        color: #ddd;
      }

      #last-js {
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 6px;
        padding: 12px;
        color: #aaa;
        font-size: 12px;
        line-height: 1.5;
        overflow: auto;
        font-family: "SF Mono", "Fira Code", Consolas, monospace;
      }

      /* Syntax highlighting */
      .sharp .id { color: #59B65C; font-style: italic; }
      .sharp .kw0 { color: rgb(100, 115, 220); font-weight: bold; }
      .sharp .kw1 { color: rgb(180, 60, 140); font-weight: bold; }
      .sharp .kw2 { color: rgb(60, 140, 80); font-weight: bold; }
      .sharp .kw3 { color: #59B65C; font-weight: bold; }
      .sharp .kw4 { color: #59B65C; font-weight: bold; }
      .sharp .comment { color: #6a9955; font-style: italic; }
      .sharp .string { color: #8B8B8B; font-weight: bold; }
      .sharp .text { }
      .sharp .numeric { color: #729AAF; }
      .sharp .directive { font-style: italic; color: #c586c0; }
      .sharp .escape { color: #409290; }
      .sharp .symbol0 { color: #d7a04c; font-weight: bold; }
      .sharp .symbol1 { color: #b36b30; font-weight: bold; }
      .sharp .constant { color: rgb(80, 170, 255); }

      /* Loading animation */
      .loading-pulse {
        animation: pulse 1.5s ease-in-out infinite;
      }

      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.4; }
      }

      /* Scrollbar styling */
      #toplevel-container::-webkit-scrollbar,
      #toplevel-side::-webkit-scrollbar {
        width: 8px;
      }
      #toplevel-container::-webkit-scrollbar-track,
      #toplevel-side::-webkit-scrollbar-track {
        background: transparent;
      }
      #toplevel-container::-webkit-scrollbar-thumb,
      #toplevel-side::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.12);
        border-radius: 4px;
      }
      #toplevel-container::-webkit-scrollbar-thumb:hover,
      #toplevel-side::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      @media (max-width: 768px) {
        #toplevel-wrapper {
          flex-direction: column;
        }
        #toplevel-container {
          flex: 1 1 50%;
          border-right: none;
        }
        #resize-handle {
          display: none;
        }
        #toplevel-side {
          flex: 1 1 50%;
        }
      }
    </style>
    <script type="text/javascript">

      window.onhashchange = function() { window.location.reload() }
      var hash = window.location.hash.replace(/^#/,"");
      var fields = hash.split(/&/);
      var prefix = "";
      var version = "";
      var main = "toplevel.js";
      var useWasm = globalThis?.WebAssembly?.JSTag;
      for(var f in fields){
        var data = fields[f].split(/=/);
        if(data[0] == "version"){
          version = data[1].replace(/%20|%2B/g,"+");
        }
        else if (data[0] == "separate"){
          main = "toplevel.bc.js";
        }
        else if (data[0] == "js"){
          useWasm = false;
        }
      }
      function load_script(url){
        var fileref=document.createElement('script');
        fileref.setAttribute("type","text/javascript");
        fileref.setAttribute("src", prefix+(version==""?"":(version+"/"))+url);
        document.getElementsByTagName("head")[0].appendChild(fileref);
      }
      if (useWasm) {
        load_script("toplevel_wasm.js");
      } else {
        load_script("exported-unit.cmis.js");
        load_script(main);
      }

    </script>
  </head>
  <body>
    <div id="toplevel-wrapper">
      <div id="toplevel-container">
        <div id="repl-watermark">OCaml</div>
        <pre id="output"></pre>
        <div>
          <div id="sharp" class="sharp"></div>
          <textarea id="userinput" class="loading-pulse">Loading ...</textarea>
          <button type="button" id="btn-share">Share</button>
        </div>
      </div>
      <div id="resize-handle"></div>
      <div id="toplevel-side">
        <div class="sidebar-header">
          <h3>Js_of_ocaml</h3>
          <p class="subtitle">A compiler from OCaml bytecode to Javascript</p>
        </div>
        <h4>Keyboard shortcuts</h4>
        <table>
          <tbody>
            <tr>
              <td>Enter</td>
              <td>Submit code</td>
            </tr>
            <tr>
              <td>Shift/Ctrl + Enter</td>
              <td>Newline</td>
            </tr>
            <tr>
              <td>Up / Down</td>
              <td>Browse history</td>
            </tr>
            <tr>
              <td>Ctrl + L</td>
              <td>Clear output</td>
            </tr>
            <tr>
              <td>Ctrl + K</td>
              <td>Reset toplevel</td>
            </tr>
            <tr>
              <td>Tab</td>
              <td>Indent code</td>
            </tr>
          </tbody>
        </table>
        <h4>Examples</h4>
        <div id="examples-row">
          <div id="toplevel-examples" class="list-group"></div>
        </div>
        <details id="js-details">
          <summary>See the generated javascript code</summary>
          <pre id="last-js">
          </pre>
        </details>
      </div>
    </div>
    <script>
      // Remove loading animation once toplevel is ready
      window.addEventListener('load', function() {
        var ta = document.getElementById('userinput');
        if (ta) ta.classList.remove('loading-pulse');
      });

      // Draggable resize handle
      (function() {
        var handle = document.getElementById('resize-handle');
        var left = document.getElementById('toplevel-container');
        var right = document.getElementById('toplevel-side');
        var dragging = false;

        handle.addEventListener('mousedown', function(e) {
          e.preventDefault();
          dragging = true;
          handle.classList.add('dragging');
          document.body.style.cursor = 'col-resize';
          document.body.style.userSelect = 'none';
        });

        document.addEventListener('mousemove', function(e) {
          if (!dragging) return;
          var wrapper = document.getElementById('toplevel-wrapper');
          var rect = wrapper.getBoundingClientRect();
          var x = e.clientX - rect.left;
          var pct = (x / rect.width) * 100;
          pct = Math.max(20, Math.min(80, pct));
          left.style.flex = '0 0 ' + pct + '%';
          right.style.flex = '1 1 0%';
        });

        document.addEventListener('mouseup', function() {
          if (!dragging) return;
          dragging = false;
          handle.classList.remove('dragging');
          document.body.style.cursor = '';
          document.body.style.userSelect = '';
        });
      })();
    </script>
  </body>
</html>
