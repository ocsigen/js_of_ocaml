module Js_of_ocaml = struct
  module Js = struct
    class type js_string = object end

    type +'a t

    type (-'a, +'b) meth_callback

    type +'a opt

    type +'a optdef

    type +'a meth

    type +'a gen_prop

    type 'a readonly_prop = < get : 'a > gen_prop

    type 'a writeonly_prop = < set : 'a -> unit > gen_prop

    type 'a prop = < get : 'a ; set : 'a -> unit > gen_prop

    type 'a optdef_prop = < get : 'a optdef ; set : 'a -> unit > gen_prop

    type +'a constr

    (****)

    type 'a callback = (unit, 'a) meth_callback

    module Unsafe = struct
      type any

      type any_js_array = any

      let inject : 'a -> any = fun _ -> assert false

      let get : 'a -> 'b -> 'c = fun _ _ -> assert false

      let set : 'a -> 'b -> 'c -> unit = fun _ _ _ -> assert false

      let meth_call : 'a -> string -> any array -> 'b = fun _ _ _ -> assert false

      let obj : (string * any) array -> 'a = fun _ -> assert false
    end

    let wrap_meth_callback : ('a -> 'b) -> ('a, 'b) meth_callback = fun _ -> assert false

    let string : string -> js_string t = fun _ -> assert false

    let undefined : unit -> 'a optdef = fun () -> assert false

    let def : 'a -> 'a optdef = fun _ -> assert false
  end
end
;;

#directory "+compiler-libs"

let () = Clflags.dump_source := true

[%%expect
{|
module Js_of_ocaml :
  sig
    module Js :
      sig
        class type js_string = object  end
        type +'a t
        type (-'a, +'b) meth_callback
        type +'a opt
        type +'a optdef
        type +'a meth
        type +'a gen_prop
        type 'a readonly_prop = < get : 'a > gen_prop
        type 'a writeonly_prop = < set : 'a -> unit > gen_prop
        type 'a prop = < get : 'a; set : 'a -> unit > gen_prop
        type 'a optdef_prop = < get : 'a optdef; set : 'a -> unit > gen_prop
        type +'a constr
        type 'a callback = (unit, 'a) meth_callback
        module Unsafe :
          sig
            type any
            type any_js_array = any
            val inject : 'a -> any
            val get : 'a -> 'b -> 'c
            val set : 'a -> 'b -> 'c -> unit
            val meth_call : 'a -> string -> any array -> 'b
            val obj : (string * any) array -> 'a
          end
        val wrap_meth_callback : ('a -> 'b) -> ('a, 'b) meth_callback
        val string : string -> js_string t
        val undefined : unit -> 'a optdef
        val def : 'a -> 'a optdef
      end
  end
|}]

let o () =
  object%js
    method m1 a b = a + b
  end

[%%expect
{|
let o () =
  (fun (type res) ->
     fun (type t1) ->
       fun (type t0) ->
         fun (type t2) ->
           fun (t2 : res Js_of_ocaml.Js.t -> t1 -> t0 -> t2)
             (_ :
               res Js_of_ocaml.Js.t ->
                 (res Js_of_ocaml.Js.t -> t1 -> t0 -> t2 Js_of_ocaml.Js.meth)
                   -> res)
             : res Js_of_ocaml.Js.t->
             Js_of_ocaml.Js.Unsafe.obj
               [|("m1",
                   (Js_of_ocaml.Js.Unsafe.inject
                      (Js_of_ocaml.Js.wrap_meth_callback t2)))|])
    (fun _ a b -> a + b) ((fun self m1 -> object method m1 = m1 self end)
    [@merlin.hide ]);;
val o :
  unit -> < m1 : int -> int -> int Js_of_ocaml.Js.meth > Js_of_ocaml.Js.t =
  <fun>
|}]

let o () =
  object%js
    method m1 a = fun b -> a + b
  end

[%%expect
{|
let o () =
  (fun (type res) ->
     fun (type t4) ->
       fun (type t3) ->
         fun (type t5) ->
           fun (t5 : res Js_of_ocaml.Js.t -> t4 -> t3 -> t5)
             (_ :
               res Js_of_ocaml.Js.t ->
                 (res Js_of_ocaml.Js.t -> t4 -> t3 -> t5 Js_of_ocaml.Js.meth)
                   -> res)
             : res Js_of_ocaml.Js.t->
             Js_of_ocaml.Js.Unsafe.obj
               [|("m1",
                   (Js_of_ocaml.Js.Unsafe.inject
                      (Js_of_ocaml.Js.wrap_meth_callback t5)))|])
    (fun _ a -> fun b -> a + b)
    ((fun self m1 -> object method m1 = m1 self end)[@merlin.hide ]);;
val o :
  unit -> < m1 : int -> int -> int Js_of_ocaml.Js.meth > Js_of_ocaml.Js.t =
  <fun>
|}]

let o () =
  object%js
    method m1 = fun a b -> a + b
  end

[%%expect
{|
let o () =
  (fun (type res) ->
     fun (type t7) ->
       fun (type t6) ->
         fun (type t8) ->
           fun (t8 : res Js_of_ocaml.Js.t -> t7 -> t6 -> t8)
             (_ :
               res Js_of_ocaml.Js.t ->
                 (res Js_of_ocaml.Js.t -> t7 -> t6 -> t8 Js_of_ocaml.Js.meth)
                   -> res)
             : res Js_of_ocaml.Js.t->
             Js_of_ocaml.Js.Unsafe.obj
               [|("m1",
                   (Js_of_ocaml.Js.Unsafe.inject
                      (Js_of_ocaml.Js.wrap_meth_callback t8)))|])
    (fun _ a b -> a + b) ((fun self m1 -> object method m1 = m1 self end)
    [@merlin.hide ]);;
val o :
  unit -> < m1 : int -> int -> int Js_of_ocaml.Js.meth > Js_of_ocaml.Js.t =
  <fun>
|}]

let o () =
  object%js
    method m1 = fun a -> fun b -> a + b
  end

[%%expect
{|
let o () =
  (fun (type res) ->
     fun (type t10) ->
       fun (type t9) ->
         fun (type t11) ->
           fun (t11 : res Js_of_ocaml.Js.t -> t10 -> t9 -> t11)
             (_ :
               res Js_of_ocaml.Js.t ->
                 (res Js_of_ocaml.Js.t ->
                    t10 -> t9 -> t11 Js_of_ocaml.Js.meth)
                   -> res)
             : res Js_of_ocaml.Js.t->
             Js_of_ocaml.Js.Unsafe.obj
               [|("m1",
                   (Js_of_ocaml.Js.Unsafe.inject
                      (Js_of_ocaml.Js.wrap_meth_callback t11)))|])
    (fun _ a -> fun b -> a + b)
    ((fun self m1 -> object method m1 = m1 self end)[@merlin.hide ]);;
val o :
  unit -> < m1 : int -> int -> int Js_of_ocaml.Js.meth > Js_of_ocaml.Js.t =
  <fun>
|}]

let o () =
  object%js
    method m1 a =
      function
      | b -> a + b
  end

[%%expect
{|
let o () =
  (fun (type res) ->
     fun (type t12) ->
       fun (type t13) ->
         fun (t13 : res Js_of_ocaml.Js.t -> t12 -> t13)
           (_ :
             res Js_of_ocaml.Js.t ->
               (res Js_of_ocaml.Js.t -> t12 -> t13 Js_of_ocaml.Js.meth) ->
                 res)
           : res Js_of_ocaml.Js.t->
           Js_of_ocaml.Js.Unsafe.obj
             [|("m1",
                 (Js_of_ocaml.Js.Unsafe.inject
                    (Js_of_ocaml.Js.wrap_meth_callback t13)))|])
    (fun _ a -> function | b -> a + b)
    ((fun self m1 -> object method m1 = m1 self end)[@merlin.hide ]);;
val o :
  unit -> < m1 : int -> (int -> int) Js_of_ocaml.Js.meth > Js_of_ocaml.Js.t =
  <fun>
|}]

let o () =
  object%js
    method m1 a =
      function
      | 0 -> a
      | b -> a + b
  end

[%%expect
{|
let o () =
  (fun (type res) ->
     fun (type t14) ->
       fun (type t15) ->
         fun (t15 : res Js_of_ocaml.Js.t -> t14 -> t15)
           (_ :
             res Js_of_ocaml.Js.t ->
               (res Js_of_ocaml.Js.t -> t14 -> t15 Js_of_ocaml.Js.meth) ->
                 res)
           : res Js_of_ocaml.Js.t->
           Js_of_ocaml.Js.Unsafe.obj
             [|("m1",
                 (Js_of_ocaml.Js.Unsafe.inject
                    (Js_of_ocaml.Js.wrap_meth_callback t15)))|])
    (fun _ a -> function | 0 -> a | b -> a + b)
    ((fun self m1 -> object method m1 = m1 self end)[@merlin.hide ]);;
val o :
  unit -> < m1 : int -> (int -> int) Js_of_ocaml.Js.meth > Js_of_ocaml.Js.t =
  <fun>
|}]

let o () =
  object%js
    method m1 (type b) a =
      function
      | 0 -> a
      | b -> a + b
  end

[%%expect
{|
let o () =
  (fun (type res) ->
     fun (type t16) ->
       fun (t16 : res Js_of_ocaml.Js.t -> t16)
         (_ :
           res Js_of_ocaml.Js.t ->
             (res Js_of_ocaml.Js.t -> t16 Js_of_ocaml.Js.meth) -> res)
         : res Js_of_ocaml.Js.t->
         Js_of_ocaml.Js.Unsafe.obj
           [|("m1",
               (Js_of_ocaml.Js.Unsafe.inject
                  (Js_of_ocaml.Js.wrap_meth_callback t16)))|])
    (fun _ (type b) a -> function | 0 -> a | b -> a + b)
    ((fun self m1 -> object method m1 = m1 self end)[@merlin.hide ]);;
val o :
  unit -> < m1 : (int -> int -> int) Js_of_ocaml.Js.meth > Js_of_ocaml.Js.t =
  <fun>
|}]

let o () =
  object%js
    method m1 a (type b) =
      function
      | 0 -> a
      | b -> a + b
  end

[%%expect
{|
let o () =
  (fun (type res) ->
     fun (type t17) ->
       fun (type t18) ->
         fun (t18 : res Js_of_ocaml.Js.t -> t17 -> t18)
           (_ :
             res Js_of_ocaml.Js.t ->
               (res Js_of_ocaml.Js.t -> t17 -> t18 Js_of_ocaml.Js.meth) ->
                 res)
           : res Js_of_ocaml.Js.t->
           Js_of_ocaml.Js.Unsafe.obj
             [|("m1",
                 (Js_of_ocaml.Js.Unsafe.inject
                    (Js_of_ocaml.Js.wrap_meth_callback t18)))|])
    (fun _ a (type b) -> function | 0 -> a | b -> a + b)
    ((fun self m1 -> object method m1 = m1 self end)[@merlin.hide ]);;
val o :
  unit -> < m1 : int -> (int -> int) Js_of_ocaml.Js.meth > Js_of_ocaml.Js.t =
  <fun>
|}]


let o () =
  object%js
    method m1 : 'a. 'a -> unit = fun a -> ignore a
  end

[%%expect {|
let o () =
  (fun (type res) ->
     fun (type t19) ->
       fun (type t20) ->
         fun (t20 : res Js_of_ocaml.Js.t -> t19 -> t20)
           (_ :
             res Js_of_ocaml.Js.t ->
               (res Js_of_ocaml.Js.t -> t19 -> t20 Js_of_ocaml.Js.meth) ->
                 res)
           : res Js_of_ocaml.Js.t->
           Js_of_ocaml.Js.Unsafe.obj
             [|("m1",
                 (Js_of_ocaml.Js.Unsafe.inject
                    (Js_of_ocaml.Js.wrap_meth_callback t20)))|])
    (fun _ a -> ignore a) ((fun self m1 -> object method m1 = m1 self end)
    [@merlin.hide ]);;
val o : unit -> < m1 : 't19 -> unit Js_of_ocaml.Js.meth > Js_of_ocaml.Js.t =
  <fun>
|}]

let o () =
  object%js
    method m1 : 'a. 'a -> unit = fun (type a) (a : a) -> ignore a
  end

[%%expect {|
let o () =
  (fun (type res) ->
     fun (type t21) ->
       fun (t21 : res Js_of_ocaml.Js.t -> t21)
         (_ :
           res Js_of_ocaml.Js.t ->
             (res Js_of_ocaml.Js.t -> t21 Js_of_ocaml.Js.meth) -> res)
         : res Js_of_ocaml.Js.t->
         Js_of_ocaml.Js.Unsafe.obj
           [|("m1",
               (Js_of_ocaml.Js.Unsafe.inject
                  (Js_of_ocaml.Js.wrap_meth_callback t21)))|])
    (fun _ (type a) (a : a) -> ignore a)
    ((fun self m1 -> object method m1 = m1 self end)[@merlin.hide ]);;
val o : unit -> < m1 : ('a -> unit) Js_of_ocaml.Js.meth > Js_of_ocaml.Js.t =
  <fun>
|}]