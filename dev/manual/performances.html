<html><head><title> Performance</title><meta charset="utf8"/><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="stylesheet" href="https://ocsigen.org/css/style.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/themes/prism.min.css"/><script type="application/javascript" src="https://ocsigen.org/js/client.js">
//<![CDATA[

//]]>
</script><script type="application/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-core.min.js">
//<![CDATA[

//]]>
</script><script type="application/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-ocaml.min.js">
//<![CDATA[

//]]>
</script><script type="application/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-clike.min.js">
//<![CDATA[

//]]>
</script><script type="application/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-reason.min.js">
//<![CDATA[

//]]>
</script><script type="application/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-javascript.min.js">
//<![CDATA[

//]]>
</script></head><body class="performances js_of_ocaml"><div class="project-page"><div class="page-header"><p class="logo-ocsigen"><a href=".././../../" class="ocsimore_phrasing_link"><img src=".././../../img/ocsigen-white.svg" alt="Ocsigen"/></a>
</p><p class="logo-subproject">Js_of_ocaml</p><div class="mainmenu"><p class="mainmenu-home"><a href=".././../../" class="ocsimore_phrasing_link">Home</a></p><p class="mainmenu-doc"><a href=".././../../tuto/" class="ocsimore_phrasing_link">Doc</a></p><p><a href=".././../../eliom/" class="ocsimore_phrasing_link">Eliom</a></p><p class="mainmenu-current"><a href=".././../../js_of_ocaml/" class="ocsimore_phrasing_link">Js_of_ocaml</a></p><p><a href=".././../../ocsigenserver/" class="ocsimore_phrasing_link">Server</a></p><p><a href=".././../../lwt/" class="ocsimore_phrasing_link">Lwt</a></p><p><a href=".././../../tyxml/" class="ocsimore_phrasing_link">Tyxml</a></p><p><a href=".././../../ocsigen-start/" class="ocsimore_phrasing_link">Start</a></p></div><form id="googlesearch" action="https://google.com/search"><input name="q" id="gsearch-box" placeholder="Search using Google"/><label for="gsearch-box"><img src="/img/search.svg" alt="" id="gsearch-icon"/></label><input type="submit" id="gsearch-submit" onclick="document.getElementById('gsearch-box').value += ' site:ocsigen.org';"/></form><aside class="how-drawer"><input id="how-drawer-toggle" type="checkbox"/><label for="how-drawer-toggle" id="how-drawer-label"><span class="how-drawer-icon"></span></label><nav class="how-drawer-content"><ul class="drawermainmenu"><li class="drawermainmenu-home"><a href=".././../../" class="ocsimore_phrasing_link">Home</a>
</li><li class="drawermainmenu-doc"><a href=".././../../tuto/" class="ocsimore_phrasing_link">Doc</a>
</li><li class="drawermainmenu-project"><a href=".././../../eliom/" class="ocsimore_phrasing_link">Eliom</a>
</li><li class="drawermainmenu-project"><a href=".././../../js_of_ocaml/" class="ocsimore_phrasing_link">Js_of_ocaml</a>
</li><li class="drawermainmenu-project"><a href=".././../../ocsigenserver/" class="ocsimore_phrasing_link">Server</a>
</li><li class="drawermainmenu-project"><a href=".././../../lwt/" class="ocsimore_phrasing_link">Lwt</a>
</li><li class="drawermainmenu-project"><a href=".././../../tyxml/" class="ocsimore_phrasing_link">Tyxml</a>
</li><li class="drawermainmenu-project"><a href=".././../../ocsigen-toolkit/" class="ocsimore_phrasing_link">Toolkit</a>
</li><li class="drawermainmenu-project"><a href=".././../../ocsigen-start/" class="ocsimore_phrasing_link">Start</a>
</li><li class="drawermainmenu-project"><a href=".././../../ocsipersist/" class="ocsimore_phrasing_link">Ocsipersist</a>
</li><li class="drawermainmenu-project"><a href=".././../../html_of_wiki/" class="ocsimore_phrasing_link">html_of_wiki</a>
</li><li class="drawermainmenu-project"><a href=".././../../ocsimore/" class="ocsimore_phrasing_link">Ocsimore (<em>deprecated</em>)</a>
</li><li class="drawermainmenu-page"><a href=".././../../projects" class="ocsimore_phrasing_link">Other projects</a>
</li><li class="drawermainmenu-page"><a href=".././../../papers" class="ocsimore_phrasing_link">Research papers</a>
</li><li class="drawermainmenu-page"><a href=".././../../credits" class="ocsimore_phrasing_link">Who does Ocsigen?</a>
</li><li class="drawermainmenu-page"><a href=".././../../contributing" class="ocsimore_phrasing_link">Contributing</a>
</li><li class="drawermainmenu-page"><a href=".././../../blog" class="ocsimore_phrasing_link">Blog</a>
</li><li class="drawermainmenu-page"><a href=".././../../install" class="ocsimore_phrasing_link">Installation</a>
</li><li class="drawermainmenu-page"><a href="https://github.com/ocsigen" class="ocsimore_phrasing_link">Source code</a>
</li></ul><nav class="how-doctree"><h2>Getting Started</h2><h3><a href="overview" class="ocsimore_phrasing_link">Overview</a></h3><h3><a href="install" class="ocsimore_phrasing_link">Installation</a></h3><h3><a href="quickstart" class="ocsimore_phrasing_link">Quick Start</a></h3><h2>Programming Guide</h2><h3><a href="javascript-interop" class="ocsimore_phrasing_link">JavaScript interop</a></h3><h3><a href="ppx" class="ocsimore_phrasing_link">PPX syntax extension</a></h3><h3><a href="ppx-deriving" class="ocsimore_phrasing_link">JSON derivation</a></h3><h3><a href="rev-bindings" class="ocsimore_phrasing_link">Export OCaml code to JavaScript</a></h3><h3><a href="errors" class="ocsimore_phrasing_link">Error handling</a></h3><h3><span><a href=".././api/js_of_ocaml/">API</a></span></h3><h2>Lwt Support</h2><h3><a href="lwt" class="ocsimore_phrasing_link">Lwt support</a></h3><h3><span><a href=".././api/js_of_ocaml-lwt/">API</a></span></h3><h2>Compiler</h2><h3><a href="options" class="ocsimore_phrasing_link">Command line options</a></h3><h3><a href="compilation-modes" class="ocsimore_phrasing_link">Compilation modes</a></h3><h3><a href="linker" class="ocsimore_phrasing_link">JavaScript primitives</a></h3><h3><a href="tailcall" class="ocsimore_phrasing_link">Tailcall optimization</a></h3><h3><a href="effects" class="ocsimore_phrasing_link">Effect handlers</a></h3><h3><a href="runtime-representation" class="ocsimore_phrasing_link">Runtime representation</a></h3><h2>Wasm_of_ocaml</h2><h3><a href="wasm_overview" class="ocsimore_phrasing_link">Overview</a></h3><h3><a href="wasm_runtime" class="ocsimore_phrasing_link">Writing Wasm primitives</a></h3><h2>How-to Guides</h2><h3><a href="build-toplevel" class="ocsimore_phrasing_link">Build a toplevel or use Dynlink</a></h3><h3><a href="debug" class="ocsimore_phrasing_link">Debug a program</a></h3><h3><a href="performances" class="ocsimore_phrasing_link">Performance</a></h3><h3><a href="contribute" class="ocsimore_phrasing_link">Contribute</a></h3><h2>Try it</h2><h3><span><a href=".././manual/files/toplevel/index.html">OCaml toplevel</a></span></h3><h3><a href="examples" class="ocsimore_phrasing_link">Examples and projects</a></h3></nav></nav></aside></div><p class="reasonwarning">Warning: Reason support is experimental.
We are looking for beta-tester and contributors.
</p><button id="reason">Switch to </button><div class="twocols"><nav class="leftcol">Version <select class="how-versions" onchange="location = this.value;"><option value=".././../dev/manual/performances" selected="selected">dev</option><option value=".././../6.3/manual/performances">6.3</option><option value=".././../6.2.0/manual/performances">6.2.0</option><option value=".././../6.1.0/manual/performances">6.1.0</option><option value=".././../6.0.1/manual/performances">6.0.1</option><option value=".././../5.9.1/manual/performances">5.9.1</option><option value=".././../5.8.2/manual/performances">5.8.2</option><option value=".././../5.7.2/manual/performances">5.7.2</option><option value=".././../5.6.0/manual/performances">5.6.0</option><option value=".././../5.5.2/manual/performances">5.5.2</option><option value=".././../5.4.0/manual/performances">5.4.0</option><option value=".././../5.3.0/manual/performances">5.3.0</option><option value=".././../5.2.0/manual/performances">5.2.0</option><option value=".././../5.1.0/manual/performances">5.1.0</option><option value=".././../5.0.1/manual/performances">5.0.1</option><option value=".././../4.1.0/manual/performances">4.1.0</option><option value=".././../4.0.0/manual/performances">4.0.0</option><option value=".././../3.11.0/manual/performances">3.11.0</option><option value=".././../3.10.0/manual/performances">3.10.0</option><option value=".././../3.9.0/manual/performances">3.9.0</option><option value=".././../3.8.0/manual/performances">3.8.0</option><option value=".././../3.7.0/manual/performances">3.7.0</option><option value=".././../3.6.0/manual/performances">3.6.0</option><option value=".././../3.5.1/manual/performances">3.5.1</option></select><nav class="how-doctree"><h2>Getting Started</h2><h3><a href="overview" class="ocsimore_phrasing_link">Overview</a></h3><h3><a href="install" class="ocsimore_phrasing_link">Installation</a></h3><h3><a href="quickstart" class="ocsimore_phrasing_link">Quick Start</a></h3><h2>Programming Guide</h2><h3><a href="javascript-interop" class="ocsimore_phrasing_link">JavaScript interop</a></h3><h3><a href="ppx" class="ocsimore_phrasing_link">PPX syntax extension</a></h3><h3><a href="ppx-deriving" class="ocsimore_phrasing_link">JSON derivation</a></h3><h3><a href="rev-bindings" class="ocsimore_phrasing_link">Export OCaml code to JavaScript</a></h3><h3><a href="errors" class="ocsimore_phrasing_link">Error handling</a></h3><h3><span><a href=".././api/js_of_ocaml/">API</a></span></h3><h2>Lwt Support</h2><h3><a href="lwt" class="ocsimore_phrasing_link">Lwt support</a></h3><h3><span><a href=".././api/js_of_ocaml-lwt/">API</a></span></h3><h2>Compiler</h2><h3><a href="options" class="ocsimore_phrasing_link">Command line options</a></h3><h3><a href="compilation-modes" class="ocsimore_phrasing_link">Compilation modes</a></h3><h3><a href="linker" class="ocsimore_phrasing_link">JavaScript primitives</a></h3><h3><a href="tailcall" class="ocsimore_phrasing_link">Tailcall optimization</a></h3><h3><a href="effects" class="ocsimore_phrasing_link">Effect handlers</a></h3><h3><a href="runtime-representation" class="ocsimore_phrasing_link">Runtime representation</a></h3><h2>Wasm_of_ocaml</h2><h3><a href="wasm_overview" class="ocsimore_phrasing_link">Overview</a></h3><h3><a href="wasm_runtime" class="ocsimore_phrasing_link">Writing Wasm primitives</a></h3><h2>How-to Guides</h2><h3><a href="build-toplevel" class="ocsimore_phrasing_link">Build a toplevel or use Dynlink</a></h3><h3><a href="debug" class="ocsimore_phrasing_link">Debug a program</a></h3><h3><a href="performances" class="ocsimore_phrasing_link">Performance</a></h3><h3><a href="contribute" class="ocsimore_phrasing_link">Contribute</a></h3><h2>Try it</h2><h3><span><a href=".././manual/files/toplevel/index.html">OCaml toplevel</a></span></h3><h3><a href="examples" class="ocsimore_phrasing_link">Examples and projects</a></h3></nav></nav><article class="rightcol"><h1> Performance</h1><p>We have compared the running time of OCaml programs executed natively,
interpreted by the bytecode interpreter, and executed by a JavaScript engine
after compilation by Js_of_ocaml.
</p><p>With a state-of-the-art JavaScript engine (such as Google's V8 and Mozilla's
SpiderMonkey), programs often run faster when compiled to JavaScript than
with the OCaml bytecode interpreter.
</p><p>Benchmarks were run in November 2022 with engines available in Ubuntu 22.04
(V8: 8.4.371.19-node.16, SpiderMonkey: JavaScript-C91.10.0).
</p><h2 id="execution-time"> Execution time <a class="backref" href="#execution-time">&#182;</a></h2><p><span><img src=".././manual/files/performances/time.png" alt="time.png"/></span>
</p><p><strong>Notes</strong>:
</p><ul><li> Exceptions are very expensive, preventing some benchmarks from finishing in reasonable time
</li><li> String operations are slow (splay) because OCaml strings cannot be mapped directly to JavaScript's immutable UTF-16 strings
</li><li> Memory allocation might be less efficient (splay, taku)
</li></ul><h2 id="code-size"> Code size <a class="backref" href="#code-size">&#182;</a></h2><p><span><img src=".././manual/files/performances/size.png" alt="size.png"/></span>
</p><p>Most of the time, the generated JavaScript code is smaller than the bytecode file.
The benchmarks are small programs that do not make much use of any library.
The generated code remains smaller than the bytecode file for large programs
(ocamlc, js_of_ocaml).
</p><p>The size gain can be much larger for programs that rely on external libraries,
thanks to dead code elimination.
</p><h2 id="vs-handwritten"> Comparison with handwritten JavaScript <a class="backref" href="#vs-handwritten">&#182;</a></h2><p><span><img src=".././manual/files/performances/nativejs.png" alt="nativejs.png"/></span>
</p><p>Comparing execution times between handwritten JavaScript and generated code
shows that results are implementation-dependent.
</p><h2 id="optimization-levels"> Compiler optimization levels <a class="backref" href="#optimization-levels">&#182;</a></h2><p><span><img src=".././manual/files/performances/size-optim.png" alt="size-optim.png"/></span>
<span><img src=".././manual/files/performances/time-optim.png" alt="time-optim.png"/></span>
</p><h2 id="effects-impact"> Effect handlers impact <a class="backref" href="#effects-impact">&#182;</a></h2><p><span><img src=".././manual/files/performances/size-effects.png" alt="size-effects.png"/></span>
<span><img src=".././manual/files/performances/size-bzip2-effects.png" alt="size-bzip2-effects.png"/></span>
<span><img src=".././manual/files/performances/time-effects.png" alt="time-effects.png"/></span>
</p><p>The performance impact of supporting effect handlers:
</p><p><strong>Size</strong>:
</p><ul><li> Code is about 20% larger
</li><li> The impact on compressed code is much lower since we add many function definitions, which are verbose in JavaScript but compress well
</li><li> The compressed code size hardly increases for large files compressed with <span class="teletype">bzip2</span>
</li><li> Code using <span class="teletype">Lwt</span>, <span class="teletype">Async</span>, or <span class="teletype">Incremental</span> can see a larger increase (up to 45% larger, or 7% larger when compressed)
</li></ul><p><strong>Speed</strong>:
</p><ul><li> Almost no impact for small monomorphic programs
</li><li> Slowdown is usually below 30%
</li><li> Can be larger for code that heavily uses higher-order functions and polymorphism (<span class="teletype">Lwt</span> code, for instance)</li></ul></article></div></div></body></html>
